<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Steele Rose CRM Management</title>

    <meta content="This shows CRM Steele Rose" name="description"/>
    <object th:include="fragments/head :: head" th:remove="tag"></object>

    <link th:href="@{/assets/pages/css/profile.min.css}" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/sowpage.css}">
</head>

<body>
<div th:include="fragments/topmenuheader :: header"></div>
<div class="container">
    <form th:object="${show_client}" th:action="@{/show_client_save}" action="#" method="post">
        <input type="hidden" class="form-control" th:field="*{id}"/>
        <input type="hidden" class="form-control" th:field="*{name}"/>
        <input type="hidden" class="form-control" th:field="*{phone}"/>
        <input type="hidden" class="form-control" th:field="*{contact}"/>
        <input type="hidden" class="form-control" th:field="*{email}"/>
        <input type="hidden" class="form-control" th:field="*{address}"/>
        <input type="hidden" class="form-control" th:field="*{maritalStatus}"/>

        <input type="hidden" class="form-control" th:field="*{company}"/>
        <input type="hidden" class="form-control" th:field="*{createdAt}"/>
        <input type="hidden" class="form-control" th:field="*{updatedAt}"/>

        <div class="row" style="padding-top: 15px;">
            <div class="col-md-12">

                <div class="panel panel-default">
                    <div class="panel-heading"><h3 style="align-content: center">Client Info</h3></div>
                </div>

                <div class="panel-body" style="padding-left: 1px;">
                    <div class="col-md-4">
                        Date: <b th:text="${#dates.format(show_client.createdAt, 'dd-MM-yyyy')}"/> <br/><br>
                        Name: <b th:text="*{name}"/> <br/>
                        Contact Person: <b th:text="*{contact}"/> <br/>
                    </div>
                    <div class="col-md-5"><br/><br/>
                        Telephone: <b th:text="${show_client.phone}"/> <br/>
                        Email: <b th:text="${show_client.email}"/><br/>
                        Reference: <b th:text="${show_client.company.name}"/><br/>
                    </div>
                    <div class="col-md-3">
                        <br/><br/>
                        <select class="form-control" th:field="*{status}">
                            <option th:each="status : ${statusList}"
                                    th:value="${status.status}"
                                    th:text="${status.status}">
                            </option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" style="padding-top: 25px;">
            <div class="col-md-4">
                Priority: &nbsp;&nbsp;
                <label><input type="radio" name="choice-radio" value="1" th:field="*{priority}">Low</label>&nbsp;&nbsp;&nbsp;&nbsp;
                <label><input type="radio" name="choice-radio" value="2" th:field="*{priority}">Medium</label>&nbsp;&nbsp;&nbsp;&nbsp;
                <label><input type="radio" name="choice-radio" value="3" th:field="*{priority}">High</label>
            </div>
            <div class="col-md-8">
                <a sec:authorize="hasAuthority('ROLE_WILLS')" th:href="@{/activeClient}" class="btn btn-warning">Active
                    Client</a>
                <a sec:authorize="hasAuthority('ROLE_WILLS')" href="/showWillsPage" class="btn btn-info">Dashboard</a>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <a th:href="@{/editClient/{id}(id=${show_client.id})}" class="btn btn-primary">Edit</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="checkbox" id="cleared" th:field="*{cleared}"
                       th:checked="*{cleared}"> &nbsp;&nbsp; EXEC &nbsp;&nbsp;&nbsp;&nbsp;

                <input type="checkbox" id="deceased" th:field="*{deceased}"
                       th:checked="*{deceased}"> &nbsp;&nbsp; DECEASED &nbsp;&nbsp;&nbsp;&nbsp;

                <input type="submit" class="btn btn-success" value="UPDATE">
                <a sec:authorize="hasAuthority('LEADS')" th:unless="*{callListId == null}" th:disabled="*{isLeads}"
                   th:href="@{/makeLeads/{id}(id=${show_client.id})}" class="btn btn-danger">Leads</a>
            </div>
        </div>
        <div class="row" style="padding-bottom: 25px;">
            <div class="col-md-7"></div>
            <div class="col-md-2" style="padding-left: 30px;"  sec:authorize="hasAuthority('TODO')">
                <input type="checkbox" id="todo" th:field="*{todos}"
                       th:checked="*{deceased}"> &nbsp;&nbsp; TODO
            </div>
        </div>
    </form>

</div>


<div id="exTab2" class="container">
    <ul class="nav nav-tabs">
        <li>
            <a href="#5" data-toggle="tab">FINANCIAL</a>
        </li>
        <li class="active"><a href="#2" data-toggle="tab">COMMENTS</a>
        </li>
        <li><a href="#3" data-toggle="tab">File Upload</a>
        </li>
        <li><a href="#4" data-toggle="tab">Draft a Letter</a>
        </li>
    </ul>

    <div class="tab-content ">

        <div class="tab-pane active" id="2">
            <div class="row" style="padding-top: 30px;">
                <form th:action="@{/submit_message}" method="post" style="margin: 0 auto;">
                    <div class="col-md-8">
                        <input type="hidden" class="form-control" name="id" th:field="*{show_client.id}"/>
                        <textarea class="form-control" name="message" id="message-text"
                                  placeholder="Write your comments..." maxlength="1900" rows="4"
                                  required autofocus></textarea>
                    </div>
                    <div class="col-md-2">
                        <input type="submit" value="Send" class="btn btn-default"/>
                    </div>
                </form>
            </div>

            <div class="row" style="padding-top: 50px;">
                <div class="col-md-10">

                    <table class="table table-bordered table-striped">
                        <tbody>
                        <tr th:each="task : ${linkedComments}">
                            <li class="comment">
                                <div class="comment-wrap">
                                    <div class="comment-author-wrap">
                                        <div class="comment-author">
                                            <label class="col-form-label">Author:</label>
                                            <strong th:text="${task.author}"> author </strong>
                                        </div>
                                        <label class="col-form-label">Date:</label>
                                        <strong th:text="${#dates.format(task.createdAt, 'dd-MM-yyyy HH:mm')}">
                                            Date </strong>
                                    </div>
                                    <div class="comment-content">
                                        <span style="white-space: pre-wrap;" th:text="${task.message}"> message </span>
                                    </div>
                                    <div class="comment-actions">
                                        <div class="reply">
                                            <div class="btn-group align-top">
                                                <button class="btn btn-sm btn-outline-secondary badge" type="button"
                                                        data-toggle="modal" data-target="#editUserModal"
                                                        th:comment-message="${task.message}"
                                                        th:client-id="${show_client.id}"
                                                        th:comment-id="${task.id}"
                                                        onclick="editModalContent(this, this.getAttribute('client-id'), this.getAttribute('comment-id'), this.getAttribute('comment-message'));">
                                                    <i class="fa fa-edit"></i></button>

                                                <button sec:authorize="hasAuthority('ADMIN')"
                                                        class="btn btn-sm btn-outline-secondary badge" type="button"
                                                        data-toggle="modal" data-target="#deleteModal"
                                                        th:comment-id="${task.id}" th:client-id="${show_client.id}"
                                                        onclick="deleteModalContent(this, this.getAttribute('client-id'), this.getAttribute('comment-id'));">
                                                    &nbsp;&nbsp; <i class="fa fa-remove"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <span class="label label-warning" th:unless="*{task.editedAuthor == null}">Edited History:</span>
                                <span th:unless="*{task.editedAuthor == null}" th:text="*{task.editedAuthor}"></span>

                            </li>
                        </tr>
                        </tbody>
                    </table>

                </div>
            </div>

        </div>

        <div class="tab-pane" id="3">

            <div class="row">
                <div class="col-md-8 mx-auto">
                    <h2>Please upload document here.</h2>
                    <!--  <p th:text="${message}" th:if="${message ne null}" class="alert alert-primary"></p>-->

                    <form method="post" enctype="multipart/form-data"
                          th:action="@{/upload/{clientId}(clientId=${show_client.id})}" action="#">
                        <div class="form-group">
                            <div class="custom-file">

                                <input type="file" class="custom-file-input" id="customFile" name="file" required
                                       autofocus>
                                <label class="custom-file-label" for="customFile">Choose file</label>
                            </div>
                        </div>
                        <button class="btn btn-primary" type="submit"> Upload File</button>
                    </form>

                </div>
            </div>

            <div class="row">
                <table>
                    <tbody>
                    <tr class="comment-wrap-tr" th:each="s3file : ${s3FileNames}">
                        <td th:text="${s3file.fileName}"/>
                        <td> &nbsp;</td>
                        <td><a th:href="@{/downloadFile/{fileName}(fileName=${s3file.fileName})}"> Download </a></td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>

        <div class="tab-pane" id="4">

            <form action="#" th:action="@{/draftWordFile}" th:object="${draftLetter}" method="POST">
                <!--<form th:action="@{/draftWordFile}" method="post">-->
                <div class="container">
                    <div class="row gutters">

                        <div class="col-lg-9">

                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-12" style="text-align: center; color: #4b8df9">
                                        <h3>Deceased Details</h3>
                                    </div>
                                    <input type="hidden" class="form-group" name="clientI" th:field="*{clientI}"/>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Deceased Name</label>
                                            <!--<input type="text" class="form-control" id="fullName" name="fullName" placeholder="Enter full name" required autofocus>-->
                                            <input type="text" class="form-control" th:field="*{deceasedName}"
                                                   placeholder="Enter deceased name" required autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Marital Status</label>
                                            <select class="form-control" th:field="*{maritalStatus}">
                                                <option th:value="SELECT" th:text="--select--">
                                                <option th:value="Married" th:text="Married">
                                                <option th:value="Divorced" th:text="Divorced">
                                                <option th:value="Widowed" th:text="Widowed">
                                                <option th:value="Single" th:text="Single">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Date of Birth</label>
                                            <input type="date" class="form-control" th:field="*{doBirth}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Date of Death</label>
                                            <input type="date" class="form-control" th:field="*{doDeath}" required
                                                   autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Date of Will</label>
                                            <input type="date" class="form-control" th:field="*{doWill}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Deceased Address</label>
                                            <textarea class="form-control" rows="3" th:field="*{deceasedAddress}"
                                                      placeholder="Enter deceased address"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-lg-12" style="text-align: center; color: #b843ea">
                                        <h3>Executors Details</h3>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" th:field="*{executorName}"
                                                   placeholder="Enter executor name" required autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Relationship</label>
                                            <input type="text" class="form-control" th:field="*{relationship}"
                                                   placeholder="Enter relationship">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Contact Number</label>
                                            <input type="text" class="form-control" th:field="*{contactNumber}"
                                                   placeholder="Enter contact number">
                                        </div>
                                    </div>

                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Executor Address</label>
                                            <textarea class="form-control" rows="3" th:field="*{executorAddress}"
                                                      placeholder="Enter executor address"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-lg-12" style="text-align: center; color: #398439">
                                        <h3>Bank Initial Letter</h3>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Our Reference</label>
                                            <input type="text" class="form-control" th:field="*{ourReference}"
                                                   placeholder="Enter our reference" required autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Your Reference</label>
                                            <input type="text" class="form-control" th:field="*{yourReference}"
                                                   placeholder="Enter your reference" required autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Estate of</label>
                                            <input type="text" class="form-control" th:field="*{estateOf}"
                                                   placeholder="Estate of" required autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Account Number</label>
                                            <input type="text" class="form-control" th:field="*{accountNumber}"
                                                   placeholder="Enter account number" required autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Bank Address</label>
                                            <textarea class="form-control" rows="4" th:field="*{bankAddress}"
                                                      placeholder="Enter bank address" required autofocus/>
                                        </div>
                                    </div>
                                    <!--<div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Email To</label>
                                            <input type="email" class="form-control" th:field="*{emailTo}" placeholder="Enter email address" required autofocus>
                                        </div>
                                    </div>-->
                                </div>


                                <div class="row gutters">
                                    <div class="col-lg-12">
                                        <div class="text-right">
                                            <button type="submit" id="submit" name="submit" class="btn btn-primary">
                                                Send/Save
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="tab-pane" id="5">

            <form th:object="${clientEP}" action="#" th:action="@{/saveEstateAsset}" method="POST">
                <input type="hidden" class="form-group" th:field="*{clientId}"/>
                <div class="container" sec:authorize="hasAuthority('ROLE_WILLS')">
                    <div class="row gutters">
                        <div class="col-lg-9">
                            <div class="card-body">

                                <div class="row gutters">
                                    <div class="col-lg-12" style="text-align: center; color: #4b8df9">
                                        <h3>&nbsp;</h3>
                                    </div>
                                    <div class="col-lg-12">

                                        <div class="col-lg-8 text-right">
                                            <label>Add other properties</label>
                                            <button th:data-id="*{clientId}" type="button"
                                                    class="btn btn-success btn-sm"
                                                    onclick="addRow(this.getAttribute('data-id'))">&plus;
                                            </button>
                                        </div>
                                        <div class="col-lg-4 text-right">
                                            <button type="submit" class="btn btn-danger">Save</button>
                                        </div>

                                    </div>
                                </div>

                                <!--LIST OF PROPERTIES-->
                                <div id="propertyList">
                                    <div th:class="${(status.index % 2) == 0} ? 'row item even' : 'row item odd'"
                                         th:each="movie, status : ${clientEP.estateProperties}">
                                        <input type="hidden" class="form-group"
                                               th:field="*{estateProperties[__${status.index}__].id}"/>
                                        <input type="hidden" class="form-group"
                                               th:field="*{estateProperties[__${status.index}__].clientId}"/>

                                        <div class="col-lg-6 padtop">
                                            <label>Estimated Estate Worth</label>
                                            <input type="number" class="form-control"
                                                   th:field="*{estateProperties[__${status.index}__].worth}"
                                                   placeholder="estate worth" required autofocus>
                                            <label>Estimated Value</label>
                                            <input type="number" class="form-control"
                                                   th:field="*{estateProperties[__${status.index}__].value}"
                                                   placeholder="estimated value" required autofocus>
                                        </div>

                                        <div class="col-lg-6 padtop">
                                            <label>Address</label>
                                            <textarea class="form-control" rows="3"
                                                      th:field="*{estateProperties[__${status.index}__].address}"
                                                      placeholder="enter address"/>

                                        </div>
                                        <div class="col-lg-6 padtop">
                                            <label>Do you own property?</label> &nbsp;&nbsp;
                                            <input type="radio" name="choice-radio" value="true"
                                                   th:field="*{estateProperties[__${status.index}__].own}"> <label>Yes
                                            &nbsp; &nbsp; No</label>
                                            <input type="radio" name="choice-radio" value="false"
                                                   th:field="*{estateProperties[__${status.index}__].own}">

                                            <button class="btn btn-sm btn-danger badge pull-right" type="button"
                                                    data-toggle="modal" data-target="#deleteEPModal" th:unless="*{estateProperties[__${status.index}__].id == null}"
                                                    th:ep-id="*{estateProperties[__${status.index}__].id}" th:client-id="${show_client.id}"
                                                    onclick="deleteEPModalContent(this, this.getAttribute('ep-id'), this.getAttribute('client-id'));">
                                                    <i class="fa fa-remove"></i></button>
                                        </div>

                                    </div>
                                </div>

                                <hr>

                                <div class="row kin-class" th:object="${clientEP.kinInfo}">
                                    <div class="col-lg-12" style="text-align: center; color: #b843ea">
                                        <h3>Next of Kin information</h3>
                                    </div>
                                    <input type="hidden" class="form-group" th:field="*{id}"/>
                                    <input type="hidden" class="form-group" th:field="*{clientId}"/>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" th:field="*{kinname}"
                                                   placeholder="kin name" required autofocus>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Relationship</label>
                                            <input type="text" class="form-control" th:field="*{kinrelationship}"
                                                   placeholder="kin relationship">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Email</label>
                                            <input type="email" class="form-control" th:field="*{kinemail}"
                                                   placeholder="email">
                                            <label>Phone</label>
                                            <input type="text" class="form-control" th:field="*{kinphone}"
                                                   placeholder="phone number">
                                        </div>
                                    </div>

                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Address</label>
                                            <textarea class="form-control" rows="4" th:field="*{kinaddress}"
                                                      placeholder="kin address"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="row" th:object="${clientEP.familyContact}">
                                    <div class="col-lg-12" style="text-align: center; color: #398439">
                                        <h3>Family contacts</h3>
                                    </div>
                                    <input type="hidden" class="form-group" th:field="*{id}"/>
                                    <input type="hidden" class="form-group" th:field="*{clientId}"/>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" th:field="*{name}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Relationship</label>
                                            <input type="text" class="form-control" th:field="*{relationship}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Email</label>
                                            <input type="email" class="form-control" th:field="*{email}">
                                            <label>Phone</label>
                                            <input type="text" class="form-control" th:field="*{phone}">
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-group">
                                            <label>Address</label>
                                            <textarea class="form-control" rows="4" th:field="*{familyaddress}"/>
                                        </div>
                                    </div>
                                </div>


                            </div>

                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<hr/>

<!-- Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenterTitle">Edit Comments</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form th:action="@{/editComment}" method="post">
                <div class="modal-body">
                    <div>
                        <input type="hidden" class="form-control" id="commentId" name="comId"/>
                        <input type="hidden" class="form-control" id="clientId" name="cId"/>
                        <textarea id="commentMessage" class="form-control" rows="5" name="comMessage"
                                  placeholder="Write your comments..." required autofocus></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Save changes">
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalTitle">Delete Comments</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form th:action="@{/deleteModalComments}" method="post">
                <div class="modal-body">
                    Are you sure you want to delete this message?
                    <input type="hidden" class="form-control" id="cltId" name="clttId"/>
                    <input type="hidden" class="form-control" id="deleteId" name="delId"/>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-danger" value="Delete">
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteEPModal" tabindex="-1" role="dialog" aria-labelledby="deleteEPModalTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteEPModalTitle">Delete Property</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form th:action="@{/deleteEPModalProperty}" method="post">
                <div class="modal-body">
                    Are you sure you want to delete this property?
                    <input type="hidden" class="form-control" id="deleteEPId" name="deleteEPId"/>
                    <input type="hidden" class="form-control" id="clientEPId" name="clientEPId"/>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-danger" value="Delete">
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

<script type='text/javascript' src='http://code.jquery.com/jquery-1.8.2.js'></script>
<script type='text/javascript' src="/scripts/bootstrap-typeahead.js"></script>
<script type='text/javascript' src="/scripts/mention.js"></script>

<script type="text/javascript" src="/js/show-client.js"></script>
</body>
</html>